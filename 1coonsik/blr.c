#include <stdio.h>
#include <unistd.h>
#include <termios.h>
#include <stdlib.h>

int getch(void) // getch를 사용 가능하게 해주는 함수
{
    int ch;
    struct termios oldattr, newattr;
    tcgetattr(STDIN_FILENO, &oldattr); // 현재 터미널 설정 읽음
    newattr = oldattr;
    newattr.c_lflag &= ~(ICANON | ECHO);        // CANONICAL과 ECHO 끔
    newattr.c_cc[VMIN] = 1;                     // 최소 입력 문자 수를 1로 설정
    newattr.c_cc[VTIME] = 0;                    // 최소 읽기 대기 시간을 0으로 설정
    tcsetattr(STDIN_FILENO, TCSANOW, &newattr); // 터미널에 설정 입력
    ch = getchar();                             // 키보드 입력 읽음
    tcsetattr(STDIN_FILENO, TCSANOW, &oldattr); // 원래의 설정으로 복구
    return ch;
}
int main(void)
{
    int a = 0;        // 공의 이동을 위한 변수
    int i = 0, j = 0; // 배열 for문
    char key;
    int brick[30][30] = {
        {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2},
        {2, 0, 0, 0, 0, 12, 12, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 13, 13, 13, 0, 0, 0, 0, 2},
        {2, 0, 0, 12, 12, 12, 12, 12, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 13, 13, 13, 13, 13, 13, 0, 0, 2},
        {2, 0, 14, 14, 14, 15, 15, 15, 16, 16, 16, 17, 17, 17, 18, 18, 18, 19, 19, 19, 20, 21, 21, 21, 22, 22, 22, 22, 0, 2},
        {2, 0, 14, 14, 14, 15, 15, 15, 16, 16, 16, 17, 17, 17, 18, 18, 18, 19, 19, 19, 20, 21, 21, 21, 22, 22, 22, 22, 0, 2},
        {2, 0, 14, 14, 14, 15, 15, 15, 16, 16, 16, 17, 17, 17, 18, 18, 18, 19, 19, 19, 20, 21, 21, 21, 22, 22, 22, 22, 0, 2},
        {2, 0, 0, 23, 23, 23, 23, 24, 24, 24, 24, 25, 25, 25, 25, 26, 26, 26, 26, 27, 27, 27, 27, 28, 28, 28, 28, 0, 0, 2},
        {2, 0, 0, 23, 23, 23, 23, 24, 24, 24, 24, 25, 25, 25, 25, 26, 26, 26, 26, 27, 27, 27, 27, 28, 28, 28, 28, 0, 0, 2},
        {2, 0, 29, 29, 29, 29, 0, 0, 0, 0, 0, 0, 0, 30, 30, 30, 30, 30, 0, 0, 0, 0, 0, 0, 0, 31, 31, 31, 0, 2},
        {2, 0, 29, 29, 29, 29, 0, 0, 0, 0, 0, 0, 0, 30, 30, 30, 30, 30, 0, 0, 0, 0, 0, 0, 0, 31, 31, 31, 0, 2},
        {2, 0, 32, 32, 32, 34, 34, 34, 44, 44, 44, 36, 36, 36, 38, 38, 38, 40, 40, 40, 45, 45, 45, 42, 42, 42, 42, 42, 0, 2},
        {2, 0, 32, 32, 32, 34, 34, 34, 0, 0, 0, 36, 36, 36, 38, 38, 38, 40, 40, 40, 0, 0, 0, 42, 42, 42, 42, 42, 0, 2},
        {2, 0, 33, 33, 33, 35, 35, 35, 0, 0, 0, 37, 37, 37, 39, 39, 39, 41, 41, 41, 0, 0, 0, 43, 43, 43, 43, 43, 0, 2},
        {2, 0, 33, 33, 33, 35, 35, 35, 0, 0, 0, 37, 37, 37, 39, 39, 39, 41, 41, 41, 0, 0, 0, 43, 43, 43, 43, 43, 0, 2},
        {2, 0, 46, 46, 46, 47, 47, 47, 48, 48, 48, 49, 49, 49, 54, 54, 54, 50, 50, 50, 51, 51, 51, 52, 52, 53, 53, 53, 0, 2},
        {2, 0, 46, 46, 46, 47, 47, 47, 48, 48, 48, 49, 49, 49, 0, 0, 0, 50, 50, 50, 51, 51, 51, 52, 52, 53, 53, 53, 0, 2},
        {2, 0, 46, 46, 46, 47, 47, 47, 48, 48, 48, 49, 49, 49, 0, 0, 0, 50, 50, 50, 51, 51, 51, 52, 52, 53, 53, 53, 0, 2},
        {2, 0, 55, 55, 55, 56, 56, 56, 57, 57, 57, 0, 0, 0, 65, 0, 65, 0, 0, 0, 61, 61, 61, 61, 62, 62, 62, 62, 0, 2},
        {2, 0, 55, 55, 55, 56, 56, 56, 57, 57, 57, 0, 0, 0, 65, 65, 65, 0, 0, 0, 61, 61, 61, 61, 62, 62, 62, 62, 0, 2},
        {2, 0, 58, 58, 58, 59, 59, 59, 60, 60, 60, 0, 0, 0, 65, 65, 65, 0, 0, 0, 63, 63, 63, 63, 64, 64, 64, 64, 0, 2},
        {2, 0, 0, 58, 58, 59, 59, 59, 60, 60, 60, 66, 66, 66, 67, 67, 67, 68, 68, 68, 63, 63, 63, 63, 64, 64, 64, 0, 0, 2},
        {2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2},
        {2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2},
        {2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2},
        {2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2},
        {2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2},
        {2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2},
        {2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2},
        {2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2},
        {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2}};

    int x = 11, y = 28;   // 좌표
    int ax = 15, ay = 27; //  공 좌표

    while (1)
    {
        system("clear");
        for (i = 0; i < 30; i++)
        {
            for (j = 0; j < 30; j++)
            {
                brick[i][j];
                if (brick[i][j] == 0 || brick[i][j]==70 || brick[i][j]==71)
                {
                    printf("  "); // 빈공간
                }
                else if (brick[i][j] == 1) // 공
                {
                    printf("● ");
                }
                else if (brick[i][j] == 2) // 외벽
                {
                    printf("□ ");
                }
                else if (brick[i][j] == 3) // 패들  좌표 (x=29,y=11~19) 3~11
                {
                    printf("( ");
                }
                else if (brick[i][j] == 4)
                {
                    printf(" ");
                }
                else if (brick[i][j] == 5)
                {
                    printf("^ ");
                }
                else if (brick[i][j] == 6)
                {
                    printf("・ ");
                }
                else if (brick[i][j] == 7)
                {
                    printf("x ");
                }
                else if (brick[i][j] == 8)
                {
                    printf("・ ");
                }
                else if (brick[i][j] == 9)
                {
                    printf("^ ");
                }
                else if (brick[i][j] == 10)
                {
                    printf(" ");
                }
                else if (brick[i][j] == 11)
                {
                    printf(") ");
                }
                else // 벽돌 12~68;
                {
                    for (int k = 12; k <= 68; k++)
                    {
                        if (brick[i][j] == k)
                        {
                            printf("■ ");
                            if ((brick[i + 1][j] == 1))
                            {
                                brick[i][j] = 70;
                                if (brick[ay + 1][ax] == 71)
                                {
                                    brick[ay][ax] = 0;
                                    ay++;
                                    brick[ay][ax] = 1;
                                }
                            }
                            
                        }
                    }
                }
            }
            printf("\n");
        }
        key = getch(); // 키 입력
        if (key == 97 || key == 65)
        {
            if (brick[x - 1][y] == 0)
            {
                for (i = -1; i < 8; i++)
                {
                    brick[y][x + i] = brick[y][x + (i + 1)];
                    brick[y][x + (i + 1)] = 0;
                }
                x--;
            }
        }
        if (key == 100 || key == 68)
        {
            if (brick[y][x + 9] == 0)
            {
                for (i = 9; i >= 1; i--)
                {
                    brick[y][x + i] = brick[y][x + (i - 1)];
                    brick[y][x + (i - 1)] = 0;
                }
                x++;
            }
        }
        if (brick[ay - 1][ax] == 0) // 공의 바로 앞 배열이 0일때 이동
        {
            brick[ay][ax] = 71;
            ay--;
            brick[ay][ax] = 1;
        }
        else if (brick[ay + 1][ax] == 71) // 공의 바로 앞 배열이 0일때 이동
        {
            brick[ay][ax] = 70;
            ay++;
            brick[ay][ax] = 1;
            
        }
    }
    return 0;
}
